function initCombobox(){$("select#dropdown").combobox({onSelect:function(a){return a.match(/national/i)?void jumpToNationalPage(which_category):void jumpToDetailPage(a)},select:function(a,b){return a.preventDefault(),a.stopPropagation(),!1},whenReady:function(){var a=$(".ui-autocomplete");a.css("visibility","hidden"),setTimeout(function(){THEES.input.autocomplete("close")},500),setTimeout(function(){a.css("visibility","visible")},750)},initialPlaceholder:"Jump to..."}),$(".custom-combobox-input").on("focus",function(){})}function highestPriorityQuestion(a){var b,c=metaMap.keys(),d=Number.MAX_VALUE;return _.each(c,function(c){var e=metaMap.get(c)[0];e.priority<d&&a==e.category&&e["question.chart"]&&"none"!=e["question.chart"]&&(d=e.priority,b=c)}),b}function switchQuestionAndRender(a){var b=metaMap.get(a);b&&(which_category=b[0].category,which_question=a,navigateToCategory(which_category,which_question,{replace:!0}),renderAllViews())}function getCardText(a,b,c){var d=_.select(cardText.get(a).get(b),function(a){return a.place==c});return d&&0!=d.length?d[0].text:""}function getCategory(){return which_category}function getState(){return which_state}function getCategoryGradient(){return categoryColorScales[which_category]}function valueOfState(a){var b=a.properties.code,c=barStateMap.get(b);if(!c)return 0;var d=Number(c.get(which_question)[0].answer);return isNaN(d)||-1==d?0:d}function promiseLoadAllDataAndOnReady(){var a=Q.defer(),b=Q.defer(),c=Q.defer(),d=Q.defer(),e=Q.defer();return d3.csv("data/All_states_TIDY.csv",function(b){a.resolve(b)}),d3.csv("data/question_metadata_TIDY.csv",function(a){d.resolve(a)}),d3.json("data/us-named.json",function(a){b.resolve(a)}),d3.csv("data/state_text.csv",function(a){e.resolve(a)}),$(function(){c.resolve()}),Q.all([a.promise.then(function(a){return barStateMap=stateNester.map(a,d3.map),a}),b.promise.then(function(a){return stateTopo=topojson.feature(a,a.objects.states).features,stateTopo=_.select(stateTopo,function(a){return-1!=STATES_AND_DC.indexOf(a.properties.code)}),stateTopoMap=stateTopoNester.map(stateTopo,d3.map),stateMesh=topojson.mesh(a,a.objects.states,function(a,b){return a!==b}),a}),d.promise.then(function(a){return metaMap=metaNester.map(a,d3.map),cardMap=cardNester.map(a,d3.map),STEMNewsReleaseMap=STEMNewsReleaseNester.map(a,d3.map),HEPASpecialReportMap=HEPASpecialReportNester.map(a,d3.map),a}),e.promise.then(function(a){return cardText=cardTextNester.map(a,d3.map),a}),c.promise])}function initializePage(){var a=window.location.href;return a.match(/detail\.html/)?void AA3.page.detail.init():a.match(/national\.html/)?void AA3.page.national.init():(a.match(/printHEPASpecialReport\.html/i)&&AA3.page.print.special.health.init(),a.match(/printstem/i)&&AA3.page.printnamechangefixcollision.special.STEM.init(),void $(AA3.socialMediaView.render))}function getAllCurrentQuestions(){var a=_.select(metaMap,function(a){a=a[0];var b=a.category==which_category;return b});return a}function renderAllViews(){function a(a,b,c){var d=$(a);d.attr("href",b+f+c).show()}var b=getCategoryGradient(),c=metaMap.get(which_question);if(!c)return void console.log("No meta data for question...");c=c[0],b.domain([c.min,c.max]),$(".site").removeClass("demandActiveCategory").removeClass("benefitsActiveCategory").removeClass("supportActiveCategory").removeClass("healthActiveCategory").removeClass("summerActiveCategory").removeClass("stemActiveCategory").addClass(which_category+"ActiveCategory");try{var d;switch(which_state||"National"){case"African.American":d="African-American Participation";break;case"Hispanic":d="Hispanic Participation";break;case"NYC":d="New York City";break;case"Allegheny":d="PA - Allegheny County";break;case"National":d="";break;default:d=stateTopoMap.get(which_state)[0].properties.name}$(".custom-combobox-input").attr("placeholder",d||"Jump to...").val(d).addClass(d?"filled":"").removeClass(d?"":"filled")}catch(e){$(".custom-combobox-input").attr("placeholder","Jump to...")}var f=which_state||"National";a(".extra.fact-download.primary","http://www.afterschoolalliance.org/documents/AA3PM-2014/","-AA3PM-2014-Fact-Sheet.pdf");var g=$(".extra.news-download.primary"),h=$(".secondaryOptionBar .extra.fact-download.secondary"),i=$(".extra.news-download.secondary.hepa"),j=$(".extra.news-download.secondary.summer"),k=$(".extra.news-download.secondary.stemCategoryExtra"),l=$(".extra.fact-download.secondary.stemCategoryExtra");"National"==f?(g.hide(),i.hide(),j.hide(),k.hide()):($("#nation-nav-button").attr("href","national.html#c/"+categoryPath(which_category,null)),h.find("span").text("Fact sheet"),a(g,"http://www.afterschoolalliance.org/press_archives/AA3PM-2014/","-AA3PM-2014-NR.pdf"),a(h,"http://www.afterschoolalliance.org/documents/AA3PM-2015/","-Kids-on-the-Move-Fact-Sheet.pdf"),a(i,"http://www.afterschoolalliance.org/press_archives/AA3PM-2015/","-Kids-on-the-Move-NR.pdf"),a(j,"http://www.afterschoolalliance.org/press_archives/AA3PM-2015/","-Summer-NR.pdf"),a(l,"http://www.afterschoolalliance.org/press_archives/AA3PM-2015/","-Full-STEM-Ahead-Fact-Sheet.pdf"),a(k,"http://www.afterschoolalliance.org/press_archives/AA3PM-2015/","-Full-STEM-Ahead-NR.pdf"),("African.American"==which_state||"Hispanic"==which_state)&&k.hide()),_.invoke(allViews,"render")}function jumpToDetailPage(a,b,c){location.href="detail.html#s/"+a+"/"+categoryPath(b||which_category,c||which_question)}function jumpToNationalPage(a,b){location.href="national.html#c/"+categoryPath(a,b)}function navigateToCategory(a,b,c){workspace.navigate("c/"+categoryPath(a,b),c)}function categoryPath(a,b){return a+(b?"/"+b:"")}function prettyStateName(a){var b=AA3.CONFIG.PRETTY_TEXT.STATE_NAME[which_state];return b||stateTopoMap.get(which_state)[0].properties.name}var AA3=_.extend({},{d3:{}},AA3);_.extend(AA3.d3,{popover:function(){function a(){function a(a){var b=a.select("g.popoverContainer"),c=a.select("rect.background");c.empty()&&a.append("svg:rect").classed("background",!0).attr("x",0).attr("y",0).attr("width",e).attr("height",f);var d=a.data();metaMap.get(d.slug);b.empty()||b.remove(),b=a.append("g").attr("class","popoverContainer");var i=d[0].properties.code,j=d[0].properties.name,k=barStateMap.get(i).get(which_question)[0],l=k.answer,m=barStateMap.get("National").get(which_question)[0].answer;m=Math.round(m);var n=metaMap.get(k.slug)[0],o=n["data.type"],p=n.min,q=n.max;"percent"==o&&(p=0,q=100),h.domain([p,q]);var r=h(l),s=.8*g,t=AA3.utility.formatType(Math.round(l),o);"NA"==l&&(r=0,t="Not available"),b.append("text").text(j).attr("y",25).attr("x",10).attr("class","popover-state-name"),b.append("text").text("Click for more details").attr("y",40).attr("x",10).attr("class","popover-sub-text"),b.append("rect").attr("width",g).attr("height",20).attr("x",10).attr("y",55).attr("rx",4).attr("ry",4).attr("fill","#D5D2CE").attr("fill-opacity",.5),b.append("rect").attr("width",r).attr("height",20).attr("x",10).attr("y",55).attr("rx",4).attr("ry",4).attr("fill","#707982").attr("fill-opacity",.5);var u=r>=s;b.append("text").attr("y",70).attr("class",function(a,b){return u?"invertColor":"none"}).attr("x",function(a){return u?r-50:r+15}).text(t),b.append("text").text("National average:").attr("class","popover-national-average").attr("y",92).attr("x",10);var v=m;v=AA3.utility.formatType(v,o),isNaN(m)&&(v="Not Available",m=0),b.append("text").text(v).attr("class","popover-national-average").attr("y",92).attr("x",110),b.append("foreignObject").attr("y",102).attr("x",10).attr("width",150).attr("height",60).append("xhtml:p").attr("xmlns","http://www.w3.org/1999/xhtml").text(n.popoverText)}var b=180,c=200,d={top:0,right:0,bottom:0,left:0},e=c-d.left-d.right,f=b-d.top-d.bottom,g=e-22,h=d3.scale.linear().domain([0,100]).range([0,g]);return a}return a}()});var AA3=_.extend({},{d3:{}},AA3);_.extend(AA3.d3,{mapLegend:function(){function a(){function a(a){var b=a.select(".legendGroup"),c=a.data()[0],d=c.slug,h=metaMap.get(c.slug)[0],i=c.gradient,j=i.range(),k=barStateMap.get("National").get(d)[0].answer,l=h["data.type"],m=1e3,n=!1;g.domain(d3.range(j.length).reverse()),xLinear.domain([h.min,h.max]),b.empty()&&(n=!0,b=a.append("svg:g").classed("legendGroup",!0).attr("transform","translate(95,60)"));var o=b.selectAll(".gradientSection").data(j),p=o.enter();p.append("svg:rect").classed("gradientSection",!0).attr("x",function(a,b){return g(b)+1}).attr("y",1).attr("height",f).attr("width",g.rangeBand()).attr("fill",j[0]),o.transition().duration(m).attr("fill",function(a){return a});var q=b.selectAll(".nationalAverage").data([k]),r=q.enter();if(r.append("svg:rect").classed("nationalAverage",!0).attr("height",f-1).attr("width",3).attr("x",0).attr("y",1).attr("stroke-width",0).attr("fill","black"),q.transition().duration(m).attr("x",xLinear(k)),n){b.append("svg:rect").classed("border",!0).attr("stroke-width",2).attr("stroke","rgba(0, 0, 0, .25)").attr("fill","none").attr("x",1).attr("y",1).attr("height",f).attr("width",e).attr("rx",5).attr("ry",5);var s=d3.select(".site .content.centeredContent").append("p").classed("posedText",!0),t=a.append("text").classed("maxText",!0).attr("x",251).attr("y",71);a.append("text").attr("class","symbol").attr("x",251).attr("y",81).text("max");var u=a.append("text").classed("minText",!0).attr("x",66).attr("y",71);a.append("text").attr("class","symbol").attr("x",66).attr("y",81).html("min")}else s=d3.select(".site .content.centeredContent").select(".posedText"),t=a.select(".maxText"),u=a.select(".minText");s.html(_.template(h.templated)({value:Math.round(k)})),t.text(AA3.utility.formatType(Math.round(h.max),l,"short")),u.text(AA3.utility.formatType(Math.round(h.min),l,"short"))}var b=270,c=104,d={top:2,right:2,bottom:2,left:2},e=(b-d.left-d.right,c-d.top-d.bottom,142),f=21,g=d3.scale.ordinal().rangeBands([e,0],0,0);return xLinear=d3.scale.linear().range([0,e]),d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},d3.selection.prototype.moveToBack=function(){return this.each(function(){var a=this.parentNode.firstChild;a&&this.parentNode.insertBefore(this,a)})},a}return a}()});var AA3=_.extend({},{d3:{}},AA3);_.extend(AA3.d3,{barCharts:function(){function a(){function a(a){function e(a){r(a)}function k(a,b){return a=o(a),b=o(b),b-a}var t=metaMap.get(which_question)[0],u=Number(t.min),v=Number(t.max);m.domain([u,v]);var w=a.select("svg.barChartContainer > g");w.empty()&&(w=a.append("svg:svg").attr("class","barChartContainer").attr("height",c).attr("width",b).append("svg:g").attr("transform","translate("+d.left+","+d.top+")")),e=$.throttle(60,e);var x=p(),y=x.length;n.domain([0,y]),l.domain(x.sort(k).map(function(a){return a.properties.code}));var z=w.selectAll(".state").data(x,function(a){return a.properties.code}),A=z.enter();z.exit();w.on("mouseleave",e);var B=A.append("svg:g").on("mousemove",e).on("click",q).attr("class","state");B.append("svg:rect").attr("class","backgroundRect clickable").attr("fill","none").attr("width",l.rangeBand()).attr("height",f).attr("x",0).attr("y",0);var C=s();B.append("svg:rect").attr("class","bar clickable").attr("width",l.rangeBand()).attr("fill",function(a,b){return C(o(a))}),B.append("svg:text").attr("x",1).attr("y",i+h+g).attr("class","clickable").text(function(a){return a.properties.code});var D=z.on("mousemove",e).transition().duration(j).delay(function(a,b){return n(y-b)}).attr("transform",function(a){return"translate("+l(a.properties.code)+", 0)"});D.selectAll(".bar").attr("height",function(a,b){return i-m(v-(o(a)-u))}).attr("y",function(a,b){return m(v-(o(a)-u))}).delay(0).attr("fill",function(a,b){return C(o(a))})}var b=940,c=65,d={top:10,right:0,bottom:10,left:0},e=b-d.left-d.right,f=c-d.top-d.bottom,g=11,h=5,i=f-g-h,j=1e3,k=100,l=d3.scale.ordinal().rangeRoundBands([e,0],.1,1),m=d3.scale.linear().domain([0,100]).range([0,i-5]),n=d3.scale.pow().exponent(.8).range([j,k]);formatPercent=d3.format(".0%");var o;a.barValue=function(b){return arguments.length?(o=b,a):o};var p;a.stateTopo=function(b){return arguments.length?(p=b,a):p};var q;a.clickState=function(b){return arguments.length?(q=b,a):q};var r;a.hoverState=function(b){return arguments.length?(r=b,a):r};var s;return a.gradient=function(b){return arguments.length?(s=b,a):s},a}return a}()});var AA3=_.extend({},{d3:{}},AA3);_.extend(AA3.d3,{usMap:function(){function a(){function a(a){function d(a){var b,c,d,e=q.select("g.statesGroup");if(a){var f=i.centroid(a);b=f[0],c=f[1],d=a}e.selectAll("path").classed("clicked",d&&function(a){return a===d}),m(a)}function g(a){var b=q.select("g.statesGroup"),c=d3.mouse(this);k(b,a,c),n(a)}var h=a.select("svg.mapContainer"),q=h.select("g");q.empty()&&(h=a.append("svg:svg").attr("class","mapContainer").attr("height",c).attr("width",b),q=h.append("svg:g").attr("transform","translate("+margin.left+","+margin.top+")"));var r=q.select("rect.eventCatcher");r.empty()&&(r=q.append("rect").attr("class","background eventCatcher").attr("width",width).attr("height",height)),r.on("click",d).on("mousemove",g).on("mouseleave",g);var s=(a.data()[0],q.select("g.statesGroup"));if(s.empty()){s=q.append("svg:g").attr("class","statesGroup")}var t=s.selectAll("path.feature").data(e,function(a){return a.properties.code}),u=t.enter(),v="#fefcf2";u.append("path").attr("d",i).attr("class","feature clickable").attr("fill",v);var w=p();if(t.on("mousemove",g).on("click",d).on("touchstart",d).transition().duration(1e3).attr("fill",function(a,b){return w(o(a))}),s.select("#state-borders").remove(),s.append("path").datum(l).attr("id","state-borders").attr("d",i),f)var x=h.append("svg:g").classed("legend",!0).attr("transform","translate(150, 0)");else x=h.select(".legend");j(x,{gradient:w,slug:which_question}),f=!1}var b=640,c=460,d=800;margin={top:50,right:0,bottom:0,left:0},width=b-margin.left-margin.right,height=c-margin.top-margin.bottom;var e,f=!0,g=d3.geo.albersUsa().scale(d).translate([width/2,height/2]),h=AA3.d3.popover(),i=d3.geo.path().projection(g),j=function(a,b){a.datum(b).call(AA3.d3.mapLegend())},k=function(a,b,c){var d=180,e=200,f=a.selectAll(".popover");if(f.empty()&&(f=a.append("g").classed("popover",!0).attr("height",d).attr("width",e)),!b)return void f.remove();c||(c=i.centroid(b));var g=c[0],j=c[1];g>430&&(g-=210),j>220&&(j-=170),f.attr("transform","translate("+g+","+j+")"),f.datum(b).call(h)};a.topoFeatures=function(b){return arguments.length?(e=b,a):e};var l;a.topoMesh=function(b){return arguments.length?(l=b,a):l};var m;a.clickState=function(b){return arguments.length?(m=b,a):m};var n;a.hoverState=function(b){return arguments.length?(n=b,a):n};var o;a.valueOfState=function(b){return arguments.length?(o=b,a):o};var p;return a.gradient=function(b){return arguments.length?(p=b,a):p},a.centroid=function(a){return i.centroid(a)},a.showPopover=function(a,b){k(a,b)},a}return a}()});var AA3=_.extend({},{d3:{}},AA3);_.extend(AA3.d3,{placeholder:function(){function a(){function a(b){var e=parseInt(b.style("height"),10),f=parseInt(b.style("width"),10),g={top:0,right:0,bottom:0,left:0},h=f-g.left-g.right,i=e-g.top-g.bottom;b.select("*").remove();var j=b.data(),k=j.title||"Placeholder d3 chart #"+c+", Update #"+d++,l=b.append("svg:svg").attr("class","placeholder").attr("width",h).attr("height",i);l.on("click",a.bind(a,b)),l.append("svg:rect").attr("width",h).attr("height",i).attr("fill","rgb(48, 48, "+Math.floor(255*Math.random())+")");var m=l.append("svg:text").attr("y",i/2).text(k);m.attr("x",(h-m.node().getBBox().width)/2)}var c=b++,d=1;return a}var b=1;return a}()});var AA3=_.extend({},{d3:{}},AA3);_.extend(AA3.d3,{bigNumberAndDonut:function(){function a(){function a(a){var h=d-f.left-f.right,i=e-f.top-f.bottom,j=Math.min(h,i)/2;c.innerRadius(30/45*j).outerRadius(j);var k=a.append("svg:svg").attr("class","bigNumberAndDonut").attr("height",e).attr("width",d).append("g").attr("transform","translate("+f.left+","+f.top+")"),l=a.data()[0];l=Math.round(l);var m=k.append("svg:text").attr("class","bigNumber").text(l+"%"),n=m.node().getBBox();m.attr("x",j-n.width/2).attr("y",Math.min(j+n.height/4,118)),k.append("g").attr("transform","translate("+h/2+","+i/2+")").selectAll("path.donut").data(b([l,100-l])).enter().append("path").attr("class",function(a,b){return"donut donutPart"+b}).attr("fill",function(a,b){return g[b]}).attr("d",c)}var d=90,e=90,f={top:0,right:0,bottom:0,left:0},g=["#2A384B","#BFCAC7"];return a.width=function(b){return arguments.length?(d=b,a):d},a.height=function(b){return arguments.length?(e=b,a):e},a.colors=function(b){return arguments.length?(g=b,a):g},a}var b=d3.layout.pie().sort(null),c=d3.svg.arc();return a}()});var AA3=_.extend({},{d3:{}},AA3);_.extend(AA3.d3,{pieChart:function(){function a(){function a(a){var h=d-f.left-f.right,i=e-f.top-f.bottom,j=Math.min(h,i)/2;c.innerRadius(0).outerRadius(j);var k=a.append("svg:svg").attr("class","pieChart").attr("height",e).attr("width",d).append("g").attr("transform","translate("+f.left+","+f.top+")"),l=a.data()[0];l=Math.round(l),k.append("g").attr("transform","translate("+h/2+","+i/2+")").selectAll("path.pie").data(b([l,100-l])).enter().append("g").attr("class","arc").append("path").attr("class",function(a,b){return"pie piePart"+b}).attr("fill",function(a,b){return g[b]}).attr("d",c)}var d=125,e=125,f={top:0,right:0,bottom:0,left:0},g=["#2A384B","#BFCAC7"];return a.arc=c,a.width=function(b){return arguments.length?(d=b,a):d},a.height=function(b){return arguments.length?(e=b,a):e},a.colors=function(b){return arguments.length?(g=b,a):g},a}var b=d3.layout.pie().sort(null),c=d3.svg.arc();return a}()});var AA3=_.extend({},{d3:{}},AA3);_.extend(AA3.d3,{justText:function(){function a(){function a(a){var c=a.data()[0],d=getCardText(which_state,c,"text");a.append("p").classed("justTextCardText",!0).classed("justTextCentered",b).html(d)}var b=!0;return a.centered=function(c){return arguments.length?(b=c,a):b},a}return a}()});var AA3=_.extend({},{d3:{}},AA3);_.extend(AA3.d3,{bigCenteredText:function(){function a(){function a(a){a.append("span").text(function(a){return Math.round(a)+"%"})}return a}return a}()});var AA3=_.extend({},AA3,{CONFIG:{CATEGORIES:["demand","benefits","support","health","summer","stem"],IMG:{LOGO:{NORMAL:"img/logo.jpg",HEALTH:"img/logo-special-report-health.gif",SUMMER:"img/Summer_AA3Logo_FINAL.png",STEM:"img/logo-stem.png"}},PRETTY_TEXT:{STATE_NAME:{"African.American":"The African-American Community",Hispanic:"The Hispanic Community",NYC:"New York City",Allegheny:"Allegheny County",DC:"The District of Columbia"},STEM_DEMOGRAPHIC_TITLE:{p_of_parents_report_stem_learning_opp:"Demographics of parents who report their child&rsquo;s afterschool program offers STEM",p_of_parents_satisfied_stem_program:"Demographics of parents who are satisfied with their child’s afterschool STEM programming",p_of_parents_consider_stem_as_factor:"Demographics of parents who consider STEM as a factor when selecting their child’s afterschool program",p_of_parents_agree_children_gain_stem:"Demographics of parents who agree that children can gain STEM skills from afterschool programs",p_of_parents_agree_should_provide_stem:"Demographics of parents who agree that afterschool programs should provide STEM learning opportunities"}}}}),AA3=_.extend({},AA3,{fixDiv:function(){var a=$(".optionBar"),b=a.first().offset().top,c=$(window),d=$("body > .navbar").height(),e=a.add("stickyFill"),f="stuckTop";c.on("scroll",function(){c.scrollTop()>b+d?e.addClass(f):e.removeClass(f)})}}),AA3=_.extend({},AA3,{utility:{formatType:function(a,b,c){var d={percent:"%",hours:" hours",days:" days",dollars:"$",weeks:" weeks"},e={hours:" hr",days:" d",weeks:" wk"},f=d[b];c&&e[b]&&(f=e[b]);var g=a+f;return"dollars"===b&&(g=f+a),g}}}),AA3=_.extend({},{d3:{}},AA3);_.extend(AA3.d3,{questionSingleBarChart:function(){function a(){function a(a){var f=b-d.left-d.right,g=c-d.top-d.bottom,h=a.append("svg").attr("class","questionSingleBarChart").attr("height",c).attr("width",b).append("g").attr("transform","translate("+d.left+","+d.top+")");e.range([0,f]),h.append("rect").attr("width",f).attr("height",g).attr("rx",3).attr("ry",3).attr("class","cardChartBackgroundBar"),h.each(function(a,b){"NA"==a||isNaN(a)?h.append("text").attr("x",6).attr("y",12).attr("fill","#6B7885").text("Not available"):(h.append("rect").attr("width",e).attr("height",g).attr("rx",3).attr("ry",3).attr("class","cardChartValueBar"),h.append("text").attr("class",function(a,b){return 80>=a?"none":"invertColor"}).attr("x",function(a){var b=e(a);return 80>=a?b+10:b-40}).attr("y",12).text(function(a){return Math.round(a)+"%"}).attr("fill","#707982"))})}var b=276,c=20,d={top:2,right:2,bottom:2,left:2},e=d3.scale.linear().domain([0,100]);return a.width=function(c){return arguments.length?(b=c,a):b},a}return a}()});var AA3=_.extend({},{d3:{}},AA3);_.extend(AA3.d3,{ThreeBarChartQuestion:function(){function a(){function a(a){var h=barStateMap.get(which_state||"National"),i=a.data()[0],j=AA3.d3.questionSingleBarChart().width(196),k=Boolean(e);if(_.each(d,function(b){var c=i+b,d=h.get(c)[0].answer,f=a.append("div").classed("clickable",k).classed("subHighlightable",k).on("click",function(){if(e){e(c),a.selectAll(".subHighlighted").classed("subHighlighted",!1),f.classed("subHighlighted",!0);var b=a.select(".gradeLevelSelectors");c.match(/(2014)/)?b.attr("style","visibility:visible;"):b.attr("style","visibility:hidden;")}}).classed("subHighlighted",c==which_question);f.append("span").text(b),f.datum(d).call(j)}),f){var l=i+"2014",m=a.append("div").classed("gradeLevelSelectors",!0);m.append("text").text("filter");var n=[{slug:"",html:"All"},{slug:"_k_to_5",html:"K-5"},{slug:"_6_to_8",html:"6-8"},{slug:"_9_to_12",html:"9-12"}];_.each(n,function(b){var c=m.append("a").classed("clickable",!0).classed("gradeCategory",!0).classed("subHighlightable",!0).classed(which_category+"Category",!0).on("click",function(){e(l+b.slug),a.selectAll(".subHighlighted").classed("subHighlighted",!1).classed("fillByCategory",!1),a.select(".subHighlightable").classed("subHighlighted",!0),c.classed("subHighlighted",!0).classed("fillByCategory",!0)}).html(b.html)})}if(g&&!which_state.match(/(african|hispanic|allegheny)/i)){var o=h.get(g)[0].answer;a.append("p").classed("projection",!0).text(o+" children in 2014")}a.call(AA3.d3.infoText().enableMoreInfo(b).metaData(c))}var b=!0;a.enableMoreInfo=function(c){return arguments.length?(b=c,a):b};var c;a.metaData=function(b){return arguments.length?(c=b,a):c};var d;a.yearRange=function(b){return arguments.length?(d=b,a):d};var e;a.onHighlight=function(b){return arguments.length?(e=b,a):e};var f;a.gradeLevels=function(b){return arguments.length?(f=b,a):f};var g;return a.projection=function(b){return arguments.length?(g=b,a):g},a}return a}()});var AA3=_.extend({},{d3:{}},AA3);_.extend(AA3.d3,{GradeLevelsThreeBarChartQuestion:function(){function a(){function a(a){var e=barStateMap.get(which_state||"National"),f=a.data()[0],g=[{slug:"k_to_5",html:"K-5&nbsp;&nbsp;"},{slug:"6_to_8",html:"6-8&nbsp;&nbsp;"},{slug:"9_to_12",html:"9-12"}],h=[{slug:"6_to_8",html:"K-8&nbsp;&nbsp;"},{slug:"9_to_12",html:"9-12"}],i=["CT","DE","HI","KY","MI","NH"],j=AA3.d3.questionSingleBarChart().width(196),k=!1,l=g;d&&-1!=i.indexOf(which_state)&&(l=h),_.each(l,function(b){var c=f+b.slug,d=e.get(c)[0].answer;d=Math.round(d);var g=a.append("div").classed("clickable",k).classed("subHighlightable",k).classed("subHighlighted",c==which_question);g.append("span").html(b.html),g.datum(d).call(j)}),a.call(AA3.d3.infoText().enableMoreInfo(b).metaData(c))}var b=!0;a.enableMoreInfo=function(c){return arguments.length?(b=c,a):b};var c;a.metaData=function(b){return arguments.length?(c=b,a):c};var d=!1;return a.combineKTo8=function(b){return arguments.length?(d=b,a):d},a}return a}()});var AA3=_.extend({},{d3:{}},AA3);_.extend(AA3.d3,{pieChartQuestion:function(){function a(){function a(a){var h=a.data()[0],i=AA3.d3.pieChart().width(f||100).height(g||100),j=b.get(h)[0].answer,k=100-j,l=a.append("div");if(l.datum(j),e){var m=parseInt(a.style("width"));l.call(i.width(f||m).height(g||m)),a.select("svg").selectAll(".arc").append("text").attr("transform",function(a){return"translate("+i.arc.centroid(a)+")"}).attr("dy",".35em").attr("class","pieBigText").attr("style","text-anchor:left;").append("tspan").attr("x",-35).attr("y",-15).text(function(a){return a.value+"%"}).append("tspan").text(function(a){return a.value==Math.round(j)?"BOYS":"GIRLS"}).attr("x",-35).attr("dy",26)}else{l.call(i);var n=l.append("div").attr("class","questionPieChartText");n.append("span").attr("class","boyValue title").text(j+"% BOYS"),n.append("span").attr("class","girlValue subtitle").text(k+"% GIRLS"),a.call(AA3.d3.infoText().enableMoreInfo(c).metaData(d))}}var b=barStateMap.get(which_state||"National"),c=!0;a.enableMoreInfo=function(b){return arguments.length?(c=b,a):c};var d;a.metaData=function(b){return arguments.length?(d=b,a):d};var e=!1;a.fillCard=function(b){return arguments.length?(e=b,a):e};var f;a.width=function(b){return arguments.length?(f=b,a):f};var g;return a.height=function(b){return arguments.length?(g=b,a):g},a}return a}()});var AA3=_.extend({},{d3:{}},AA3);_.extend(AA3.d3,{multipleReason:function(){function a(){function a(a){var e=b-d.left-d.right,f=c-d.top-d.bottom,g=(Math.min(e,f)/2,a.data()[0]);a.append("div").attr("class","questionReasonList").append("ol").selectAll("li").data(g).enter().append("li").text(function(a){return a})}var b=125,c=125,d={top:0,right:0,bottom:0,left:0},e=["#2A384B","#BFCAC7"];return a.width=function(c){return arguments.length?(b=c,a):b},a.height=function(b){return arguments.length?(c=b,a):c},a.colors=function(b){return arguments.length?(e=b,a):e},a}return a}()});var AA3=_.extend({},{d3:{}},AA3);_.extend(AA3.d3,{multipleReasonQuestion:function(){function a(){function a(a){var f=a.data()[0],g=AA3.d3.multipleReason().width(100).height(100),h=[];_.each(e,function(a){var c=f.split("reason_")[1].slice(1),d="reason_"+a+c,e=b.get(d)[0].answer;""!==e&&h.push(e)}),a.datum(h).call(g),a.call(AA3.d3.infoText().enableMoreInfo(c).metaData(d))}var b=barStateMap.get("National"),c=!0;a.enableMoreInfo=function(b){return arguments.length?(c=b,a):c};var d;a.metaData=function(b){return arguments.length?(d=b,a):d};var e;return a.reasonNumbers=function(b){return arguments.length?(e=b,a):e},a}return a}()});var AA3=_.extend({},{d3:{}},AA3);_.extend(AA3.d3,{bigText:function(){function a(){function a(a){var e=b-d.left-d.right,h=c-d.top-d.bottom;Math.min(e,h)/2;text_data=a.data()[0];var i=Boolean(g);a.append("div").attr("class","questionBigText"),_.each(text_data,function(b){var c=a.append("div").classed("clickable",i).classed("subHighlightable",i).on("click",function(){g&&(g(b.slug),a.selectAll(".subHighlighted").classed("subHighlighted",!1),c.classed("subHighlighted",!0))}).classed("subHighlighted",b.slug==which_question);b.timeUnit?(c.append("span").attr("class","questionBigTextNumber").text(Math.round(b.number)),c.append("span").attr("class","questionBigTextUnit").text(f[b.timeUnit])):c.append("span").attr("class","questionBigTextNumber").text((b.dollar?"$":"")+d3.format(",.0f")(b.number))})}var b=125,c=125,d={top:0,right:0,bottom:0,left:0},e=["#2A384B","#BFCAC7"],f={hr:"HOURS",hr_per_day:"HOURS PER DAY",day:"DAYS",week:"WEEKS"};a.width=function(c){return arguments.length?(b=c,a):b},a.height=function(b){return arguments.length?(c=b,a):c},a.colors=function(b){return arguments.length?(e=b,a):e};var g;return a.onHighlight=function(b){return arguments.length?(g=b,a):g},a}return a}()});var AA3=_.extend({},{d3:{}},AA3);_.extend(AA3.d3,{avgTimeQuestion:function(){function a(){function a(a){var g=a.data()[0],h=AA3.d3.bigText();h.onHighlight&&h.onHighlight(f);var i=[];_.each(e,function(a){var c="_per"+g.split("avg_")[1].split("_per")[1],d="avg_"+a+c,e=b.get(d)[0].answer;e=Math.round(e),e&&i.push({number:e,timeUnit:a,slug:d})}),a.append("div").attr("class","questionBigTextYear").text(2014),a.datum(i).call(h),a.datum(g).call(AA3.d3.infoText().enableMoreInfo(c).metaData(d))}var b=barStateMap.get(which_state||"National"),c=!0;a.enableMoreInfo=function(b){return arguments.length?(c=b,a):c};var d;a.metaData=function(b){return arguments.length?(d=b,a):d};var e;a.timeUnits=function(b){return arguments.length?(e=b,a):e};var f;return a.onHighlight=function(b){return arguments.length?(f=b,a):f},a}return a}()});var AA3=_.extend({},{d3:{}},AA3);_.extend(AA3.d3,{bigNumberAndDonutQuestion:function(){function a(){function a(a){var f=a.data()[0],g=AA3.d3.bigNumberAndDonut(),h=b.get(f)[0].answer;h=Math.round(h);var i=a.append("div").attr("class","questionDonut").append("div");if(i.datum(h),e){a.classed("fillCard",!0);var j=200;i.call(g.width(j).height(j))}else location.href.match(/detail\.html|printHEPASpecialReport\.html/i)?(g=AA3.d3.bigCenteredText(),i.attr("class","bigCenteredText").append("div").call(g),a.classed("centerMoreInfo",!0).datum(f).call(AA3.d3.infoText().enableMoreInfo(c).metaData(d))):(i.call(g),a.datum(f).call(AA3.d3.infoText().enableMoreInfo(c).metaData(d)))}var b=barStateMap.get(which_state||"National"),c=!0;a.enableMoreInfo=function(b){return arguments.length?(c=b,a):c};var d;a.metaData=function(b){return arguments.length?(d=b,a):d};var e;return a.fillCard=function(b){return arguments.length?(e=b,a):e},a}return a}()});var AA3=_.extend({},{d3:{}},AA3);_.extend(AA3.d3,{bigDollarQuestion:function(){function a(){function a(a){var e=a.data()[0],h=AA3.d3.bigText(),i=b.get(e)[0].answer;i=Math.round(i),!f&&g&&a.append("div").attr("class","questionBigTextYear").text(2014),a.datum([{number:i,dollar:!0}]).call(h),f?a.classed("fillCard",!0):a.datum(e).call(AA3.d3.infoText().enableMoreInfo(c).metaData(d))}var b=barStateMap.get(which_state||"National"),c=!0;a.enableMoreInfo=function(b){return arguments.length?(c=b,a):c};var d;a.metaData=function(b){return arguments.length?(d=b,a):d};var e;a.timeUnits=function(b){return arguments.length?(e=b,a):e};var f=!1;a.fillCard=function(b){return arguments.length?(f=b,a):f};var g=!0;return a.showYear=function(b){return arguments.length?(g=b,a):g},a}return a}()});var AA3=_.extend({},{d3:{}},AA3);_.extend(AA3.d3,{infoText:function(){function a(){function a(a){var d=a.data()[0];if(location.href.match(/detail\.html|printHEPASpecialReport\.html/i))var e=getCardText(which_state,d,"text")||c.cardViewMoreInfo;else var e=c.questionViewMoreInfo;if(e&&""!=e){if(b)var f=a.append("p").attr("class","more-info clickable").text("More info +").on("click",function(){g.style("display","inherit"),f.style("display","none")});var g=a.append("div").attr("class","more");g.append("p").html(e),b&&(g.append("p").attr("class","less-info clickable").text("Less info -").on("click",function(){g.style("display","none"),f.style("display","inherit")}),$(document).ready(function(){$(".more").hide()}))}}var b=!0;a.enableMoreInfo=function(c){return arguments.length?(b=c,a):b};var c;return a.metaData=function(b){return arguments.length?(c=b,a):c},a}return a}()});var AA3=_.extend({},{d3:{}},AA3);_.extend(AA3.d3,{basicListQuestion:function(){function a(){function a(a){var f=a.data()[0],g=AA3.d3.multipleReason().width(100).height(100),h=[];_.each(e,function(a){var c=f.split("ans_")[1].slice(1),d="ans_"+a+c,e=b.get(d)[0].answer;""!==e&&h.push(e)}),a.datum(h).call(g),a.call(AA3.d3.infoText().enableMoreInfo(c).metaData(d))}var b=barStateMap.get(which_state||"National"),c=!0;a.enableMoreInfo=function(b){return arguments.length?(c=b,a):c};var d;a.metaData=function(b){return arguments.length?(d=b,a):d};var e;return a.reasonNumbers=function(b){return arguments.length?(e=b,a):e},a}return a}()});var AA3=_.extend({},{d3:{}},AA3);_.extend(AA3.d3,{doubleQuestion:function(){function a(){function a(a){a.classed("doubleQuestionHolder",!0);var b=a.append("div").classed("doubleQuestionContents",!0);b.call(c,d),b.append("img").classed("questionDottedLine",!0).attr("src","img/questionDottedLine.png"),b.call(c,e),a.call(AA3.d3.infoText().enableMoreInfo(f).metaData(g))}function c(a,c){var d=barStateMap.get(which_state||"National"),e=c.slug,f=d.get(e)[0].answer,g=Boolean(h),i=a.append("div").classed("clickable",g).classed("subHighlightable",g).on("click",function(){
h&&(h(c.slug),a.selectAll(".subHighlighted").classed("subHighlighted",!1),i.classed("subHighlighted",!0))}).classed("subHighlighted",c.slug==which_question);i.append("span").html(c.title),i.append("br"),i.datum(f).call(b)}var d;a.top=function(b){return arguments.length?(d=b,a):d};var e;a.bottom=function(b){return arguments.length?(e=b,a):e};var f=!0;a.enableMoreInfo=function(b){return arguments.length?(f=b,a):f};var g;a.metaData=function(b){return arguments.length?(g=b,a):g};var h;return a.onHighlight=function(b){return arguments.length?(h=b,a):h},a}var b=AA3.d3.questionSingleBarChart().width(196);return a}()});var AA3=_.extend({},AA3,{D3View:Backbone.View.extend({el:null,chart:AA3.d3.placeholder(),placeholder:AA3.d3.placeholder(),chartSelection:null,getData:null,initialize:function(a){_.bindAll(this,"render"),this.getData=a.getData||this.model.get.bind(this.model,"data"),this.chart=a.chart||this.placeholder,this.renderPlaceholder()},renderPlaceholder:function(){return this.chartSelection=d3.select(this.el).datum([]).call(this.placeholder),this},render:function(){return this.$(".placeholder").remove(),this.chartSelection=d3.select(this.el).datum(this.getData()).call(this.chart),this}})}),AA3=_.extend({},AA3,{QuestionsView:Backbone.View.extend({PAGE_BREAK_INDEX:3,el:null,placeholder:AA3.d3.placeholder(),getCategory:null,getHighlight:null,highlight:null,firstRender:!0,initialize:function(a){_.bindAll(this,"render"),this.getCategory=a.getCategory,this.getHighlight=a.getHighlight,this.highlight=a.highlight;var b=$("#questionsView-questionTemplate").text();this.questionTemplate=_.template(b)},constructAllCharts:function(){var a=this,b=metaMap.values(),c=this.getHighlight();$();b=b.sort(function(a,b){return a[0].priority-b[0].priority});var d=(this.$el,d3.select(this.el));d.selectAll("*").remove(),_.each(b,function(b,e){function f(b){if(this!=window){var c=$(this);if(c.hasClass("questionHolder")||(c=c.parents(".questionHolder")),!b&&c.hasClass("highlightedQuestion"))return;$(".questionHolder").addClass("clickable"),c.removeClass("clickable")}var d=h,e=metaMap.get(b);e&&(d=b),a.highlight(d)}var g=b[0],h=g.slug,i=g["question.chart"],j=g.category,k=h==c;if("none"==i)return void console.log("No chart specified for "+h);var l=a.questionTemplate({title:g.questionViewTitle}),m=AA3.SideBarQuestions[i];if(!m)return void console.log("Chart not found for "+h);var n=m();n.onHighlight&&n.onHighlight(f);var o=d.append("div").classed("questionHolder",!0).classed(j+"CategoryVisible",!0).classed(j+"Category",!0).classed("highlightedQuestion",k).classed("slug_"+h,!0).classed("clickable",!0).on("click",f).html(l).classed("pagebreakBefore",e>0&&e%a.PAGE_BREAK_INDEX==0);o.select(".questionHeader").classed("fillByCategory",k).classed("colorByCategory",!k).classed(j+"Category",!0).classed("clickable",!0),o.select(".questionChart").append("div").attr("class","question").datum(i).call(n)})},renderPlaceholder:function(){return this.chartSelection=d3.select(this.el).datum([]).call(this.placeholder),this},lastCategory:null,lastHighlightedSlug:null,lastimgpath:null,render:function(){function a(){return b.select(".questionHolder.slug_"+f)}this.firstRender&&this.constructAllCharts();var b=d3.select(this.el),c=this.getCategory(),d=c+"CategoryVisible",e=this.getHighlight(),f=e;if(b.selectAll(".questionHolder").attr("style","display:none;"),b.selectAll(".questionHolder."+d).attr("style","display:inherit;"),this.lastCategory!=c){$("#questionsWrapper")[0].scrollTop=0;var g=$("#mainLogo"),h={original:$(".mainText .originalParagraphEnd"),health:$(".mainText .hepaParagraphEnd"),summer:$(".mainText .summerParagraphEnd"),stem:$(".mainText .stemParagraphEnd")},i=AA3.CONFIG.IMG.LOGO["health"==c?"HEALTH":"summer"==c?"SUMMER":"stem"==c?"STEM":"NORMAL"];-1!=["demand","benefits","support"].indexOf(c)&&-1!=["demand","benefits","support"].indexOf(this.lastCategory)?($enterText=$(),$exitText=$()):($exitText=h[this.lastCategory]||h.original,$enterText=h[c]||h.original),$exitText==h.original&&$enterText==h.original&&($exitText=h.health.add(h.summer).add(h.stem)),this.lastimgpath!=i&&g.animate({opacity:0},250).promise().then(function(){g.attr("src",i).animate({opacity:1},250)}),this.lastimgpath=i,$exitText.animate({opacity:0}).promise().then(function(){$exitText.css("display","none"),$enterText.css("display","inline").animate({opacity:1})})}this.lastCategory=c,b.selectAll(".highlightedQuestion").classed("highlightedQuestion",!1),a().empty()&&f.match(/2008/)&&(f=f.replace(/\d\d\d\d.*/,2013)),a().empty()&&(f=f.replace(/\d\d\d\d.*/,2014)),a().empty()&&(f=e.replace("day","hr")),a().empty()&&(f=e.replace("physical_variety","physical_amount")),a().empty()&&(f=e.replace("healthy_snacks","programs_snacks"));var j=a();this.lastHighlightedSlug!=f&&(d3.selectAll(".more").style("display","none"),d3.selectAll(".more-info.clickable").style("display","inherit")),this.lastHighlightedSlug=f,j.classed("highlightedQuestion",!0),b.selectAll(".questionHeader").classed("fillByCategory",!1).classed("colorByCategory",!0),j.select(".questionHeader").classed("fillByCategory",!0).classed("colorByCategory",!1).classed("highlightedQuestion",!0),b.selectAll(".subHighlightable").classed("subHighlighted",!1).classed("fillByCategory",!1),j.select(".subHighlightable").classed("subHighlighted",!0);var k=$(j.node());if(this.firstRender&&k.size()>0){var l=2e3;this.$el.animate({scrollTop:k.position().top},l)}this.firstRender=!1}})}),AA3=_.extend({},AA3,{CardsView:Backbone.View.extend({el:null,placeholder:AA3.d3.placeholder(),getQuestions:null,getCategory:null,containerTitles:{parent_satisfaction:"Parent Satisfaction with Afterschool Programs",public_support:"Public Support for Afterschool Programs",unmet_demand:"Children Unsupervised After School & Unmet Demand",children_in_afterschool:"Children in Afterschool",physical_activity:"Physical Activity and Afterschool Programs",healthy_eating:"Healthy Eating and Afterschool Programs",summer_general:"Summer Learning Programs",stem_a:"STEM Learning in Afterschool Programs"},initialize:function(a){_.bindAll(this,"render"),this.getQuestions=a.getQuestions,this.getCategory=a.getCategory;var b=$("#cardsView-sectionTemplate").text(),c=$("#cardsView-cardTemplate").text();this.sectionTemplate=_.template(b),this.cardTemplate=_.template(c)},constructAllContainersAndCards:function(){var a=this,b=d3.select(this.el);b.selectAll("*").remove(),document.body.scrollTop=0;a.getQuestions(),a.getCategory();_.each(AA3.CONFIG.CATEGORIES,function(c){var d=cardMap.get(c);AA3.scrollspy=AA3.scrollspy||{},AA3.scrollspy[c]=AA3.scrollspy[c]||{},AA3.scrollspy[c].el=b.append("a").classed("clearfix",!0),_.each(d,function(d,e){if(!(e.length<2)){d=_.map(d,function(a){return a}).sort(function(a,b){return a[0].statePriority-b[0].statePriority}),e in a.containerTitles||(e=e.substring(1));var f=a.sectionTemplate({title:a.containerTitles[e],category:c}),g=b.append("div").html(f),h=g.select(".cardSectionBody"),i=g.select(".section-accordion"),j=g.select(".end-spacer"),k=!0,l=$(h.node()),m=$(j.node());i.on("click",function(){k?(l.hide("medium"),i.text("+"),m.hide("medium")):(l.show("medium"),i.text("-"),m.show("medium")),k=!k}),_.each(d,function(b,c){if(b=b[0],("African.American"!=which_state&&"Hispanic"!=which_state||"no"!=b["is.on.demographics"])&&!(which_state.match(/(nyc|allegheny)/i)&&"no"==b["is.on.city.county"]||which_state.match(/(allegheny)/i)&&b.slug.match(/p_of_boys/i))){var d=b["card.chart"],e=b.category;if("none"!=d){var f=AA3.CardCharts[d];if(f){var g=f(),i=b.cardTitle;try{i=getCardText(which_state,d,"title")||i}catch(j){console.log("Card title never set because of error: ",j)}var k=a.cardTemplate({title:i}),l=h.append("div").html(k);l.classed(e+"Category",!0),l.classed("cardCategory",!0),l.select(".cardBody").append("div").attr("class","cardChart").datum(d).call(g)}}}})}})}),b.append("div").classed("background-extender",!0),_.each(AA3.scrollspy,function(a,b){a.offset=$(a.el.node()).offset().top}),$(".changeCategoryBtn").on("click",function(){var b=$(this),c=b.data("category");a.scrollToContainer(c)}),$(".back-to-top").css("visibility","visible").hide(),a.toggleBackToTopVisible(),$(window).on("scroll",a.toggleBackToTopVisible),$(".back-to-top").on("click",function(){a.scrollToContainer("top")}),b.append("div").classed("background-extender",!0)},toggleBackToTopVisible:function(){$(window).scrollTop()>400?$(".back-to-top").fadeIn():$(".back-to-top").fadeOut()},scrollToContainer:function(a){var b,c=this;b="top"==a||"demand"==a?0:AA3.scrollspy[a].offset,AA3.inScrollTransition=!0,$("html, body").stop().animate({scrollTop:b-256},750,function(a){AA3.inScrollTransition=!1,c.toggleBackToTopVisible()})},firstRender:!0,lastState:null,render:function(){(this.firstRender||this.lastState!=which_state)&&(this.constructAllContainersAndCards(),this.scrollToContainer(which_category),this.lastState=which_state),this.firstRender=!1}})}),AA3=_.extend({},AA3,{HEPASpecialReportCardsView:Backbone.View.extend({el:null,placeholder:AA3.d3.placeholder(),getQuestions:null,getCategory:null,containerTitleTemplates:{public_support:'<%= state_name %> parents <span class="colorByCategory">support</span> public funding for afterschool programs',children_in_afterschool:'<span class="colorByCategory">Demand</span> for afterschool programs in <%= state_name %>',physical_activity:'<%= state_name %> parents <span class="colorByCategory">satisfied</span> with their child&rsquo;s afterschool program',healthy_eating:'<%= state_name %>&rsquo;s afterschool programs support <span class="colorByCategory">Health and Wellness</span>'},initialize:function(a){_.bindAll(this,"render"),this.getQuestions=a.getQuestions,this.getCategory=a.getCategory,this.keys=a.keys;var b=$("#cardsView-sectionTemplate").text(),c=$("#cardsView-cardTemplate").text();this.sectionTemplate=_.template(b),this.cardTemplate=_.template(c)},constructAllContainersAndCards:function(){var a=this,b=d3.select(this.el);b.selectAll("*").remove(),document.body.scrollTop=0;var c=1;a.getQuestions(),a.getCategory();_.each(["demand","health","support"],function(d){var e=HEPASpecialReportMap.get(d);_.each(e,function(e,f){if(!(f.length<2)&&(e=_.map(e,function(a){return a}).sort(function(a,b){return a[0].statePriority-b[0].statePriority}),f in a.containerTitleTemplates||(f=f.substring(1)),-1!=a.keys.indexOf(f))){var g=_.template(a.containerTitleTemplates[f]),h=a.sectionTemplate({title:g({state_name:prettyStateName(which_state)}),category:d,index:c++}),i=b.append("div").html(h),j=i.select(".cardSectionBody"),k=i.select(".end-spacer");$(j.node()),$(k.node());_.each(e,function(b,c){if(b=b[0],("African.American"!=which_state&&"Hispanic"!=which_state||"no"!=b["is.on.demographics"])&&!(which_state.match(/(nyc|allegheny)/i)&&"no"==b["is.on.city.county"]||which_state.match(/(allegheny)/i)&&b.slug.match(/p_of_boys/i))){var d=b["HEPASpecialReport.chart"],e=b.category;if("none"!=d){var f=AA3.CardCharts[d];if(f){var g=f(),h=b.cardTitle;try{h=getCardText(which_state,d,"title")||h}catch(i){console.log("Card title never set because of error: ",i)}var k=a.cardTemplate({title:h}),l=j.append("div"),m=l.html(k);m.classed(e+"Category",!0),m.select(".cardBody").append("div").attr("class","cardChart").datum(d).call(g),b.slug.match(/p_of_parents_satisfied_programs_physical_amount/i)&&m.select(".cardHeader").text("Parents satisfied with the amount of physical activity in their child's afterschool program"),b.slug.match(/p_of_parents_satisfied_healthy_snacks/i)&&$(j.node()).prepend(l.node())}}}})}})}),b.append("div").classed("background-extender",!0),$(".back-to-top").css("visibility","visible").hide()},firstRender:!0,lastState:null,render:function(){(this.firstRender||this.lastState!=which_state)&&(this.constructAllContainersAndCards(),this.lastState=which_state),this.firstRender=!1}})}),AA3=_.extend({},AA3,{STEMCardsView:Backbone.View.extend({el:null,placeholder:AA3.d3.placeholder(),getQuestions:null,getCategory:null,containerTitleTemplates:{children_in_afterschool:'<span class="colorByCategory">Demand</span> for afterschool programs in <%= state_name %>',stem_b:'Parents think afterschool programs <span class="colorByCategory">should offer STEM learning opportunities</span> in <%= state_name %>',stem_a:'Parents are <span class="colorByCategory">noticing the STEM offerings</span> in their child&rsquo;s afterschool program in <%= state_name %>'},initialize:function(a){_.bindAll(this,"render"),this.getQuestions=a.getQuestions,this.getCategory=a.getCategory,this.keys=a.keys;var b=$("#cardsView-sectionTemplate").text(),c=$("#cardsView-cardTemplate").text();this.sectionTemplate=_.template(b),this.cardTemplate=_.template(c)},constructAllContainersAndCards:function(){var a=this,b=d3.select(this.el);b.selectAll("*").remove(),document.body.scrollTop=0;var c=1;a.getQuestions(),a.getCategory();_.each(["stem","demand"],function(d){var e=STEMNewsReleaseMap.get(d);_.each(e,function(e,f){if(!(f.length<2)&&(e=_.map(e,function(a){return a}).sort(function(a,b){return a[0].statePriority-b[0].statePriority}),f in a.containerTitleTemplates||(f=f.substring(1)),-1!=a.keys.indexOf(f))){var g=_.template(a.containerTitleTemplates[f]),h=a.sectionTemplate({title:g({state_name:prettyStateName(which_state)}),category:d,index:c++}),i=b.append("div").html(h),j=i.select(".cardSectionBody"),k=i.select(".end-spacer");$(j.node()),$(k.node());_.each(e,function(b,c){if(b=b[0],("African.American"!=which_state&&"Hispanic"!=which_state||"no"!=b["is.on.demographics"])&&(!which_state.match(/(nyc|allegheny)/i)||"no"!=b["is.on.city.county"])){var d=b["STEMNewsRelease.chart"],e=b.category;if(b.slug.match(/p_of_parents_report_stem_learning_opp/i))var f="Parents who report that their child&rsquo;s afterschool program offers STEM learning opportunities";if(b.slug.match(/p_of_parents_satisfied_stem_program/i))var f="Parents satisfied with the STEM learning opportunities offered in their child&rsquo;s afterschool program";if(b.slug.match(/p_of_parents_consider_stem_as_factor/i))var f="Parents who consider STEM as a factor when selecting their child&rsquo;s afterschool program";if(b.slug.match(/p_of_parents_agree_children_gain_stem/i))var f="Parents who agree that children can gain STEM skills from afterschool programs";if(b.slug.match(/p_of_parents_agree_should_provide_stem/i))var f="Parents who think afterschool programs should provide opportunities to explore and engage in hands-on STEM learning";if(b.slug.match(/p_of_children_in_programs_/i))var f="Afterschool program participation in <%= state_name %>",g="In 2014, <%= percentagez %>% of <%= state_name %>&rsquo;s children participated in an afterschool program.";if(b.slug.match(/p_of_children_would_be_enrolled_/i))var f="Children who would participate if an afterschool program were available",g="In 2014, <%= percentagez %>% of <%= state_name %>&rsquo;s children would have participated in an afterschool program if one was available.";if("none"!=d){var h=AA3.CardCharts[d];if(h){var i=h(),k=b.cardTitle;try{k=getCardText(which_state,d,"title")||k}catch(l){console.log("Card title never set because of error: ",l)}f&&(k=_.template(f)({state_name:prettyStateName(which_state)}));var m=a.cardTemplate({title:k}),n=j.append("div"),o=n.html(m);o.classed(e+"Category",!0),b.slug.match(/p_of_parents_agree_should_provide_stem/i)&&(b.cardViewMoreInfo=!1),o.select(".cardBody").append("div").attr("class","cardChart").datum(d).call(i),g&&(hackedCardText=_.template(g)({state_name:prettyStateName(which_state),percentagez:Math.round(parseFloat(barStateMap.get(which_state).get(d+"2014")[0].answer,10))}),o.select(".more > p").html(hackedCardText))}}}})}})}),b.append("div").classed("background-extender",!0),$(".back-to-top").css("visibility","visible").hide()},firstRender:!0,lastState:null,render:function(){(this.firstRender||this.lastState!=which_state)&&(this.constructAllContainersAndCards(),this.lastState=which_state),this.firstRender=!1}})}),AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{p_of_children_in_programs_:function(){function a(){function a(a){a.call(AA3.d3.ThreeBarChartQuestion().metaData(c).yearRange([2014,2009,2004]).onHighlight(b).gradeLevels(!0))}var b,c=(barStateMap.get("National"),metaMap.get("p_of_children_in_programs_2014")[0]);return a.onHighlight=function(c){return arguments.length?(b=c,a):b},a}return a}()});var AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{p_of_children_alone_:function(){function a(){function a(a){a.call(AA3.d3.ThreeBarChartQuestion().metaData(c).yearRange([2014,2009,2004]).onHighlight(b).gradeLevels(!0))}var b,c=(barStateMap.get("National"),metaMap.get("p_of_children_alone_2014")[0]);return a.onHighlight=function(c){return arguments.length?(b=c,a):b},a}return a}()});var AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{p_of_children_would_be_enrolled_:function(){function a(){function a(a){a.call(AA3.d3.ThreeBarChartQuestion().metaData(c).yearRange([2014,2009,2004]).onHighlight(b).gradeLevels(!0))}var b,c=(barStateMap.get("National"),metaMap.get("p_of_children_would_be_enrolled_2014")[0]);return a.onHighlight=function(c){return arguments.length?(b=c,a):b},a}return a}()});var AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{p_of_parents_satisfied_child_program_:function(){function a(){function a(a){a.call(AA3.d3.ThreeBarChartQuestion().metaData(c).yearRange([2014,2009,2004]).onHighlight(b))}var b,c=(barStateMap.get("National"),metaMap.get("p_of_parents_satisfied_child_program_2014")[0]);return a.onHighlight=function(c){return arguments.length?(b=c,a):b},a}return a}()});var AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{p_of_parents_support_public_funding_:function(){function a(){function a(a){a.call(AA3.d3.ThreeBarChartQuestion().metaData(c).yearRange([2014,2009]).onHighlight(b))}var b,c=(barStateMap.get("National"),metaMap.get("p_of_parents_support_public_funding_2014")[0]);return a.onHighlight=function(c){return arguments.length?(b=c,a):b},a}return a}()});var AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{p_of_boys_program:function(){function a(){function a(a){a.call(AA3.d3.pieChartQuestion().metaData(b))}var b=(barStateMap.get("National"),metaMap.get("p_of_boys_program")[0]);return a}return a}()});var AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{reason_1_not_enrolling_child:function(){function a(){function a(a){a.call(AA3.d3.multipleReasonQuestion().metaData(b).reasonNumbers([1,2,3]))}var b=(barStateMap.get("National"),metaMap.get("reason_1_not_enrolling_child")[0]);return a}return a}()});var AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{avg_hr_per_week_in_programs:function(){function a(){function a(a){a.call(AA3.d3.avgTimeQuestion().metaData(c).timeUnits(["hr","day"]).onHighlight(b))}var b,c=(barStateMap.get("National"),metaMap.get("avg_hr_per_week_in_programs")[0]);return a.onHighlight=function(c){return arguments.length?(b=c,a):b},a}return a}()});var AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{avg_hr_per_week_alone:function(){function a(){function a(a){a.call(AA3.d3.avgTimeQuestion().metaData(c).timeUnits(["hr"]).onHighlight(b))}var b,c=(barStateMap.get("National"),metaMap.get("avg_hr_per_week_alone")[0]);return a.onHighlight=function(c){return arguments.length?(b=c,a):b},a}return a}()});var AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{p_of_children_programs_qualify_federal_asst:function(){function a(){function a(a){a.call(AA3.d3.bigNumberAndDonutQuestion().metaData(b))}var b=metaMap.get("p_of_children_programs_qualify_federal_asst")[0];return a}return a}()});var AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{avg_dolllars_spent_per_week_program:function(){function a(){function a(a){a.call(AA3.d3.bigDollarQuestion().metaData(b))}var b=(barStateMap.get("National"),metaMap.get("avg_dolllars_spent_per_week_program")[0]);return a}return a}()});var AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{p_of_parents_satisfied_program_safe:function(){function a(){function a(a){a.call(AA3.d3.bigNumberAndDonutQuestion().metaData(b))}var b=metaMap.get("p_of_parents_satisfied_program_safe")[0];return a}return a}()});var AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{p_of_parents_satisfied_program_quality_of_care:function(){function a(){function a(a){a.call(AA3.d3.bigNumberAndDonutQuestion().metaData(b))}var b=metaMap.get("p_of_parents_satisfied_program_quality_of_care")[0];return a}return a}()});var AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{p_of_parents_programs_excite_abt_learning:function(){function a(){function a(a){a.call(AA3.d3.bigNumberAndDonutQuestion().metaData(b))}var b=metaMap.get("p_of_parents_programs_excite_abt_learning")[0];return a}return a}()});var AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{p_of_parents_programs_help_child_gain_skills:function(){function a(){function a(a){a.call(AA3.d3.bigNumberAndDonutQuestion().metaData(b))}var b=metaMap.get("p_of_parents_programs_help_child_gain_skills")[0];return a}return a}()});var AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{p_of_parents_programs_reduce_risky:function(){function a(){function a(a){a.call(AA3.d3.bigNumberAndDonutQuestion().metaData(b))}var b=metaMap.get("p_of_parents_programs_reduce_risky")[0];return a}return a}()});var AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{p_of_parents_receive_public_funding:function(){function a(){function a(a){a.call(AA3.d3.bigNumberAndDonutQuestion().metaData(b))}var b=metaMap.get("p_of_parents_receive_public_funding")[0];return a}return a}()});var AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{p_of_parents_working_parents_keep_jobs:function(){function a(){function a(a){a.call(AA3.d3.bigNumberAndDonutQuestion().metaData(b))}var b=metaMap.get("p_of_parents_working_parents_keep_jobs")[0];return a}return a}()});var AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{p_of_parents_working_parents_peace:function(){function a(){function a(a){a.call(AA3.d3.bigNumberAndDonutQuestion().metaData(b))}var b=metaMap.get("p_of_parents_working_parents_peace")[0];return a}return a}()});var AA3=_.extend({},{SideBarQuestions:{}},AA3);!function(){function a(a){function b(a){a.call(AA3.d3.bigNumberAndDonutQuestion().metaData(c))}var c=metaMap.get(a)[0];return b}var b=["p_of_parents_agree_should_provide_snacks","p_of_parents_programs_offers_snacks","p_of_parents_satisfied_programs_snacks","p_of_parents_satisfied_healthy_snacks","p_of_parents_snacks_important","p_of_parents_healthy_snacks_important","p_of_parents_agree_should_provide_physical","p_of_parents_programs_offers_physical","p_of_parents_satisfied_programs_physical_amount","p_of_parents_satisfied_programs_physical_variety","p_of_parents_physical_important"];b.forEach(function(b,c){var d={};d[b]=a.bind(null,b),_.extend(AA3.SideBarQuestions,d)})}();var AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{health_snacks_double:function(){function a(){function a(a){a.call(AA3.d3.doubleQuestion().top({title:"Snacks and/<br/>or meals",slug:"p_of_parents_satisfied_programs_snacks"}).bottom({title:"Snacks and/or meals<br/>that are <strong>healthy</strong>",slug:"p_of_parents_satisfied_healthy_snacks"}).onHighlight(b).enableMoreInfo(!0).metaData(c))}var b,c=(barStateMap.get("National"),metaMap.get("p_of_parents_satisfied_programs_snacks")[0]);return a.onHighlight=function(c){return arguments.length?(b=c,a):b},a}return a}()});var AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{health_activity_double:function(){function a(){function a(a){a.call(AA3.d3.doubleQuestion().top({title:"<strong>Amount</strong> of physical <br />activity",slug:"p_of_parents_satisfied_programs_physical_amount"}).bottom({title:"<strong>Variety</strong> of physical <br />activity",slug:"p_of_parents_satisfied_programs_physical_variety"}).onHighlight(b).enableMoreInfo(!0).metaData(c))}var b,c=(barStateMap.get("National"),metaMap.get("p_of_parents_satisfied_programs_physical_amount")[0]);return a.onHighlight=function(c){return arguments.length?(b=c,a):b},a}return a}()});var AA3=_.extend({},{SideBarQuestions:{}},AA3);!function(){function a(a){function b(a){a.call(AA3.d3.bigNumberAndDonutQuestion().metaData(c))}var c=metaMap.get(a)[0];return b}var b=["p_of_parents_report_stem_learning_opp","p_of_parents_satisfied_stem_program","p_of_parents_consider_stem_as_factor","p_of_parents_agree_children_gain_stem","p_of_parents_agree_should_provide_stem"];b.forEach(function(b,c){var d={};d[b]=a.bind(null,b),_.extend(AA3.SideBarQuestions,d)})}();var AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{p_family_child_summer_2013:function(){function a(){function a(a){a.call(AA3.d3.doubleQuestion().top({title:"2013",slug:"p_family_child_summer_2013"}).bottom({title:"2008",slug:"p_family_child_summer_2008"}).onHighlight(b).enableMoreInfo(!1).metaData(c))}var b,c=(barStateMap.get("National"),metaMap.get("p_family_child_summer_2013")[0]);return a.onHighlight=function(c){return arguments.length?(b=c,a):b},a}return a}()});var AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{p_family_want_summer:function(){function a(){function a(a){a.call(AA3.d3.bigNumberAndDonutQuestion().metaData(b))}var b=metaMap.get("p_family_want_summer")[0];return a}return a}()});var AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{p_of_parents_agree_summer_academic:function(){function a(){function a(a){a.call(AA3.d3.bigNumberAndDonutQuestion().metaData(b))}var b=metaMap.get("p_of_parents_agree_summer_academic")[0];return a}return a}()});var AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{avg_hr_per_day_summer:function(){function a(){function a(a){var d=national.get(b)[0].answer;d=Math.round(d);var e=[{number:d,timeUnit:"hr",slug:b}];a.datum(e).call(AA3.d3.bigText().onHighlight(c)),a.datum(b).call(AA3.d3.infoText().enableMoreInfo(!0).metaData(meta))}var b="avg_hr_per_day_summer";national=barStateMap.get(which_state||"National"),meta=metaMap.get(b)[0];var c;return a.onHighlight=function(b){return arguments.length?(c=b,a):c},a}return a}()});var AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{avg_weeks_per_summer:function(){function a(){function a(a){var f=d.get(c)[0].answer;f=Math.round(f);var g=[{number:f,timeUnit:"week",slug:c}];a.datum(g).call(AA3.d3.bigText().onHighlight(b)),a.datum(c).call(AA3.d3.infoText().enableMoreInfo(!0).metaData(e))}var b,c="avg_weeks_per_summer",d=barStateMap.get(which_state||"National"),e=metaMap.get(c)[0];return a.onHighlight=function(c){return arguments.length?(b=c,a):b},a}return a}()});var AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{avg_dollars_per_week_summer:function(){function a(){function a(a){a.call(AA3.d3.bigDollarQuestion().metaData(b).showYear(!1))}var b=(barStateMap.get("National"),metaMap.get("avg_dollars_per_week_summer")[0]);return a}return a}()});var AA3=_.extend({},{SideBarQuestions:{}},AA3);_.extend(AA3.SideBarQuestions,{p_of_parents_support_public_funding_summer:function(){function a(){function a(a){a.call(AA3.d3.doubleQuestion().top({title:"2014",slug:"p_of_parents_support_public_funding_summer"}).bottom({title:"2009",slug:"p_of_parents_support_public_funding_summer_2009"}).onHighlight(b).enableMoreInfo(!1).metaData(c))}var b,c=metaMap.get("p_of_parents_support_public_funding_summer")[0];return a.onHighlight=function(c){return arguments.length?(b=c,a):b},a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{p_of_children_in_programs_:function(){function a(){function a(a){var b=metaMap.get("p_of_children_in_programs_2014")[0];a.call(AA3.d3.ThreeBarChartQuestion().metaData(b).yearRange([2014,2009,2004]).enableMoreInfo(!1).projection("real_of_children_in_programs_2014"))}return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{p_of_children_alone_:function(){function a(){function a(a){a.call(AA3.d3.ThreeBarChartQuestion().metaData(b).yearRange([2014,2009,2004]).enableMoreInfo(!1).projection("real_of_children_alone_2014"))}var b=metaMap.get("p_of_children_alone_2014")[0];return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{p_of_children_would_be_enrolled_:function(){function a(){function a(a){a.call(AA3.d3.ThreeBarChartQuestion().metaData(b).yearRange([2014,2009,2004]).enableMoreInfo(!1).projection("real_of_children_would_be_enrolled_2014"))}var b=metaMap.get("p_of_children_would_be_enrolled_2014")[0];return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{p_of_parents_satisfied_child_program_:function(){function a(){function a(a){a.call(AA3.d3.ThreeBarChartQuestion().metaData(b).yearRange([2014,2009,2004]).enableMoreInfo(!1))}var b=metaMap.get("p_of_parents_satisfied_child_program_2014")[0];return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{p_of_parents_support_public_funding_:function(){function a(){function a(a){a.datum("p_of_parents_support_public_funding_2014").call(AA3.d3.bigNumberAndDonutQuestion().metaData(b).enableMoreInfo(!1).fillCard(!1))}var b=(barStateMap.get("National"),metaMap.get("p_of_parents_support_public_funding_2014")[0]);return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{p_of_boys_program:function(){function a(){function a(a){a.call(AA3.d3.pieChartQuestion().metaData(b).enableMoreInfo(!1).fillCard(!0).height(200).width(200))}var b=(barStateMap.get("National"),metaMap.get("p_of_boys_program")[0]);return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{reason_1_not_enrolling_child:function(){function a(){function a(a){a.call(AA3.d3.multipleReasonQuestion().metaData(b).reasonNumbers([1,2,3]).enableMoreInfo(!1))}var b=(barStateMap.get("National"),metaMap.get("reason_1_not_enrolling_child")[0]);return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{avg_hr_per_week_in_programs:function(){function a(){function a(a){a.call(AA3.d3.avgTimeQuestion().metaData(b).timeUnits(["hr","day"]).enableMoreInfo(!1))}var b=(barStateMap.get("National"),metaMap.get("avg_hr_per_week_in_programs")[0]);return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{avg_hr_per_week_alone:function(){function a(){function a(a){a.call(AA3.d3.avgTimeQuestion().metaData(b).timeUnits(["hr"]).enableMoreInfo(!1))}var b=(barStateMap.get("National"),metaMap.get("avg_hr_per_week_alone")[0]);return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{p_of_children_programs_qualify_federal_asst:function(){function a(){function a(a){a.call(AA3.d3.bigNumberAndDonutQuestion().metaData(b).enableMoreInfo(!1).fillCard(!0))}var b=metaMap.get("p_of_children_programs_qualify_federal_asst")[0];return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{avg_dolllars_spent_per_week_program:function(){function a(){function a(a){a.call(AA3.d3.bigDollarQuestion().metaData(b).enableMoreInfo(!1).fillCard(!1).showYear(!0))}var b=metaMap.get("avg_dolllars_spent_per_week_program")[0];return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{p_of_parents_satisfied_program_safe:function(){function a(){function a(a){a.call(AA3.d3.bigNumberAndDonutQuestion().metaData(b).enableMoreInfo(!1).fillCard(!0))}var b=metaMap.get("p_of_parents_satisfied_program_safe")[0];return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{p_of_parents_satisfied_program_quality_of_care:function(){function a(){function a(a){a.call(AA3.d3.bigNumberAndDonutQuestion().metaData(b).enableMoreInfo(!1).fillCard(!0));
}var b=metaMap.get("p_of_parents_satisfied_program_quality_of_care")[0];return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{p_of_parents_programs_excite_abt_learning:function(){function a(){function a(a){a.call(AA3.d3.bigNumberAndDonutQuestion().metaData(b).enableMoreInfo(!1).fillCard(!0))}var b=metaMap.get("p_of_parents_programs_excite_abt_learning")[0];return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{p_of_parents_programs_help_child_gain_skills:function(){function a(){function a(a){a.call(AA3.d3.bigNumberAndDonutQuestion().metaData(b).enableMoreInfo(!1).fillCard(!0))}var b=metaMap.get("p_of_parents_programs_help_child_gain_skills")[0];return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{p_of_parents_programs_reduce_risky:function(){function a(){function a(a){a.call(AA3.d3.bigNumberAndDonutQuestion().metaData(b).enableMoreInfo(!1).fillCard(!0))}var b=metaMap.get("p_of_parents_programs_reduce_risky")[0];return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{p_of_parents_receive_public_funding:function(){function a(){function a(a){a.call(AA3.d3.bigNumberAndDonutQuestion().metaData(b).enableMoreInfo(!1).fillCard(!0))}var b=metaMap.get("p_of_parents_receive_public_funding")[0];return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{p_of_children_in_programs_2014_:function(){function a(){function a(a){var b=metaMap.get("p_of_children_in_programs_2014_k_to_5")[0];a.datum("p_of_children_in_programs_2014_").call(AA3.d3.GradeLevelsThreeBarChartQuestion().metaData(b).enableMoreInfo(!1))}return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{p_of_children_alone_2014_:function(){function a(){function a(a){var b=metaMap.get("p_of_children_in_programs_2014_k_to_5")[0];a.datum("p_of_children_alone_2014_").call(AA3.d3.GradeLevelsThreeBarChartQuestion().metaData(b).enableMoreInfo(!1).combineKTo8(!0))}return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{p_of_children_would_be_enrolled_2014_:function(){function a(){function a(a){var b=metaMap.get("p_of_children_in_programs_2014_k_to_5")[0];a.datum("p_of_children_would_be_enrolled_2014_").call(AA3.d3.GradeLevelsThreeBarChartQuestion().metaData(b).enableMoreInfo(!1))}return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{p_of_parents_working_parents_peace:function(){function a(){function a(a){a.call(AA3.d3.bigNumberAndDonutQuestion().metaData(b).enableMoreInfo(!1).fillCard(!1))}var b=metaMap.get("p_of_parents_working_parents_peace")[0];return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{p_of_parents_working_parents_keep_jobs:function(){function a(){function a(a){a.call(AA3.d3.bigNumberAndDonutQuestion().metaData(b).enableMoreInfo(!1).fillCard(!1))}var b=metaMap.get("p_of_parents_working_parents_keep_jobs")[0];return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{just_text_demand_unmet:function(){function a(){function a(a){a.classed("barriersToEnrollment",!0).call(AA3.d3.justText().centered(!1))}return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{just_text_demand_children_in_afterschool:function(){function a(){function a(a){a.classed("justTextDemandParticipation",!0).call(AA3.d3.justText())}return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{ans_1_select_program:function(){function a(){function a(a){a.call(AA3.d3.justText().centered(!1))}metaMap.get("ans_1_select_program")[0];return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{ans_1_type_activity:function(){function a(){function a(a){a.call(AA3.d3.justText().centered(!1))}metaMap.get("ans_1_type_activity")[0];return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{ans_1_program_provider:function(){function a(){function a(a){a.call(AA3.d3.justText().centered(!1))}metaMap.get("ans_1_program_provider")[0];return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{p_of_parents_program_public_school_bldg:function(){function a(){function a(a){a.call(AA3.d3.bigNumberAndDonutQuestion().metaData(b).enableMoreInfo(!1).fillCard(!1))}var b=metaMap.get("p_of_parents_program_public_school_bldg")[0];return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);!function(){function a(a){function b(a){c.slug.match(/p_of_parents_satisfied_programs_physical_amount/i)&&(c.cardViewMoreInfo=""),a.call(AA3.d3.bigNumberAndDonutQuestion().metaData(c).enableMoreInfo(!1).fillCard(!c.cardViewMoreInfo))}var c=metaMap.get(a)[0];return b}var b=["p_of_parents_agree_should_provide_snacks","p_of_parents_programs_offers_snacks","p_of_parents_satisfied_programs_snacks","p_of_parents_satisfied_healthy_snacks","p_of_parents_snacks_important","p_of_parents_healthy_snacks_important","p_of_parents_agree_should_provide_physical","p_of_parents_programs_offers_physical","p_of_parents_satisfied_programs_physical_amount","p_of_parents_satisfied_programs_physical_variety","p_of_parents_physical_important"];b.forEach(function(b,c){var d={};d[b]=a.bind(null,b),_.extend(AA3.CardCharts,d)})}();var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{health_activity_double:function(){function a(){function a(a){a.call(AA3.d3.doubleQuestion().top({title:"<strong>Amount</strong> of physical activity",slug:"p_of_parents_satisfied_programs_physical_amount"}).bottom({title:"<strong>Variety</strong> of physical activity",slug:"p_of_parents_satisfied_programs_physical_variety"}).onHighlight(b).enableMoreInfo(!1).metaData(c))}var b,c=(barStateMap.get("National"),metaMap.get("p_of_parents_satisfied_programs_physical_amount")[0]);return a.onHighlight=function(c){return arguments.length?(b=c,a):b},a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{health_snacks_double:function(){function a(){function a(a){a.call(AA3.d3.doubleQuestion().top({title:"Snacks and/or meals",slug:"p_of_parents_satisfied_programs_snacks"}).bottom({title:"Snacks and/or meals that are <strong>healthy</strong>",slug:"p_of_parents_satisfied_healthy_snacks"}).onHighlight(b).enableMoreInfo(!1).metaData(c))}var b,c=(barStateMap.get("National"),metaMap.get("p_of_parents_satisfied_programs_snacks")[0]);return a.onHighlight=function(c){return arguments.length?(b=c,a):b},a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);!function(){function a(a){function b(a){a.call(AA3.d3.bigNumberAndDonutQuestion().metaData(c).enableMoreInfo(!1).fillCard(!c.cardViewMoreInfo))}var c=metaMap.get(a)[0];return b}var b=["p_of_parents_report_stem_learning_opp","p_of_parents_satisfied_stem_program","p_of_parents_consider_stem_as_factor","p_of_parents_agree_children_gain_stem","p_of_parents_agree_should_provide_stem"];b.forEach(function(b,c){var d={};d[b]=a.bind(null,b),_.extend(AA3.CardCharts,d)})}();var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{p_family_child_summer_2013:function(){function a(){function a(a){a.call(AA3.d3.doubleQuestion().top({title:"2013",slug:"p_family_child_summer_2013"}).bottom({title:"2008",slug:"p_family_child_summer_2008"}).onHighlight(b).enableMoreInfo(!1).metaData(c))}var b,c=(barStateMap.get("National"),metaMap.get("p_family_child_summer_2013")[0]);return a.onHighlight=function(c){return arguments.length?(b=c,a):b},a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{p_family_want_summer:function(){function a(){function a(a){a.call(AA3.d3.bigNumberAndDonutQuestion().metaData(b).enableMoreInfo(!1).fillCard(!0))}var b=metaMap.get("p_family_want_summer")[0];return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{p_of_parents_agree_summer_academic:function(){function a(){function a(a){a.call(AA3.d3.bigNumberAndDonutQuestion().metaData(b).enableMoreInfo(!1).fillCard(!1))}var b=metaMap.get("p_of_parents_agree_summer_academic")[0];return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{avg_hr_per_day_summer:function(){function a(){function a(a){var g=e.get(c)[0].answer;g=Math.round(g);var h=[{number:g,timeUnit:"hr_per_day",slug:c}],i=e.get(d)[0].answer;i=Math.round(i);var j=[{number:i,timeUnit:"week",slug:d}];a.datum(h).call(AA3.d3.bigText().onHighlight(b)),a.datum(j).call(AA3.d3.bigText().onHighlight(b)),a.datum(c).call(AA3.d3.infoText().enableMoreInfo(!1).metaData(f))}var b,c="avg_hr_per_day_summer",d="avg_weeks_per_summer",e=barStateMap.get(which_state||"National"),f=metaMap.get(c)[0];return a.onHighlight=function(c){return arguments.length?(b=c,a):b},a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{avg_dollars_per_week_summer:function(){function a(){function a(a){a.call(AA3.d3.bigDollarQuestion().metaData(b).enableMoreInfo(!1).fillCard(!1).showYear(!1))}var b=metaMap.get("avg_dollars_per_week_summer")[0];return a}return a}()});var AA3=_.extend({},{CardCharts:{}},AA3);_.extend(AA3.CardCharts,{p_of_parents_support_public_funding_summer:function(){function a(){function a(a){a.call(AA3.d3.doubleQuestion().top({title:"2014",slug:"p_of_parents_support_public_funding_summer"}).bottom({title:"2009",slug:"p_of_parents_support_public_funding_summer_2009"}).onHighlight(b).enableMoreInfo(!1).metaData(c))}var b,c=metaMap.get("p_of_parents_support_public_funding_summer")[0];return a.onHighlight=function(c){return arguments.length?(b=c,a):b},a}return a}()});var AA3=_.extend({},{supplemental:{}},AA3);_.extend(AA3.supplemental,{DonutMoreInfo:function(){function a(){function a(a){var d=(a.data()[0],AA3.d3.bigNumberAndDonut().height(90).width(90));a.call(d),a.append("span").attr("class","title").text(b),c&&a.append("span").attr("class","moreInfoBtn clickable").html("More Info ").on("click",c).append("span").classed("right-arrow-chevron",!0).html("&#8250;")}var b;a.title=function(c){return arguments.length?(b=c,a):b};var c;return a.moreInfo=function(b){return arguments.length?(c=b,a):c},a}return a}()});var AA3=_.extend({},{supplemental:{}},AA3);_.extend(AA3.supplemental,{Pie:function(){function a(){function a(a){var d=(a.data()[0],AA3.d3.pieChart().height(90).width(90));a.call(d),a.append("span").attr("class","boys title").text(b),a.append("span").attr("class","girls subtitle").text(c)}var b;a.title=function(c){return arguments.length?(b=c,a):b};var c;return a.subtitle=function(b){return arguments.length?(c=b,a):c},a}return a}()});var AA3=_.extend({},{supplemental:{}},AA3);_.extend(AA3.supplemental,{reasonList:function(){function a(){function a(a){var b=[],j=-1!==d.slug.indexOf("reason_")?"reason_":"ans_";_.each(e,function(a){var e=d.slug.split(j)[1].slice(1),f=j+a+e,g=c.get(f);if(g){var h=g[0].answer;""!==h&&b.push(h)}}),a.classed("notFirst",!i).classed("borderRight",f).classed("halfWidth",g),a.append("div").attr("class","reasonListTitle").text(d.questionViewTitle),list_width=Math.max(250,a.select(".reasonListTitle").node().getBoundingClientRect().width,h)+"px",a.append("div").attr("class","questionReasonList").style("width",list_width).append("ol").selectAll("li").data(b).enter().append("li").text(function(a){return a})}var b,c=barStateMap.get("National");a.title=function(c){return arguments.length?(b=c,a):b};var d;a.metaData=function(b){return arguments.length?(d=b,a):d};var e;a.reasonNumbers=function(b){return arguments.length?(e=b,a):e};var f=!1;a.borderRight=function(b){return arguments.length?(f=b,a):f};var g=!1;a.halfWidth=function(b){return arguments.length?(g=b,a):g};var h;a.width=function(b){return arguments.length?(h=b,a):h};var i=!1;return a.firstSupplemental=function(b){return arguments.length?(i=b,a):i},a}return a}()});var AA3=_.extend({},{supplemental:{}},AA3);_.extend(AA3.supplemental,{percentageReasonList:function(){function a(){function a(a){var b=[],j=-1!==d.slug.indexOf("reason_")?"reason_":"ans_";_.each(e,function(a){var e={},f=d.slug.split(j)[1].slice(1),g=j+a+f,h=c.get(g),i="p_for_"+g,k=c.get(i);if(h){var l=h[0].answer,m=k[0].answer;""!==l&&(e.value=l,e.percent=m,e.slug=g,b.push(e))}}),a.classed("notFirst",!i).classed("borderRight",f).classed("halfWidth",g),a.append("div").attr("class","reasonListTitle").text(d.questionViewTitle),list_width=Math.max(250,a.select(".reasonListTitle").node().getBoundingClientRect().width,h)+"px";var k=a.append("div").attr("class","questionReasonList").style("width",list_width).append("div").selectAll("div").data(b,function(a){return a.slug}),l=k.enter(),m=l.append("div");m.append("span").text(function(a,b){return Math.round(a.percent)+"% - "}),m.append("span").classed("entryText",!0).text(function(a){return a.value})}var b,c=barStateMap.get("National");a.title=function(c){return arguments.length?(b=c,a):b};var d;a.metaData=function(b){return arguments.length?(d=b,a):d};var e;a.reasonNumbers=function(b){return arguments.length?(e=b,a):e};var f=!1;a.borderRight=function(b){return arguments.length?(f=b,a):f};var g=!1;a.halfWidth=function(b){return arguments.length?(g=b,a):g};var h;a.width=function(b){return arguments.length?(h=b,a):h};var i=!1;return a.firstSupplemental=function(b){return arguments.length?(i=b,a):i},a}return a}()});var AA3=_.extend({},{supplemental:{}},AA3);_.extend(AA3.supplemental,{bigCenteredText:function(){function a(){function a(a){var c=(a.data()[0],AA3.d3.bigCenteredText());a.call(c),a.append("span").attr("class","title").text(b)}var b;return a.title=function(c){return arguments.length?(b=c,a):b},a}return a}()});var AA3=_.extend({},AA3,{SupplementalDataView:Backbone.View.extend({el:null,placeholder:AA3.d3.placeholder(),currentCategory:null,currentQuestion:null,initialize:function(a){_.bindAll(this,"render"),this.currentCategory=a.currentCategory,this.currentQuestion=a.currentQuestion;var b=$("#supplementalDataView-questionTemplate").text();this.questionTemplate=_.template(b)},renderPlaceholder:function(){return this.chartSelection=d3.select(this.el).datum([]).call(this.placeholder),this},render:function(){var a=this.currentCategory(),b=this.lastCategory,c=this.currentQuestion(),d=AA3.supplemental.DonutMoreInfo().title("African-American").moreInfo(function(){jumpToDetailPage("African.American")}),e=barStateMap.get("African.American").get(c)[0].answer;e=Math.round(e);var f=AA3.supplemental.DonutMoreInfo().title("Hispanic").moreInfo(function(){jumpToDetailPage("Hispanic")}),g=barStateMap.get("Hispanic").get(c)[0].answer;g=Math.round(g);var h=AA3.supplemental.DonutMoreInfo().title("FRPL").moreInfo(!1),i=barStateMap.get("FRPL").get(c)[0].answer;g=Math.round(g);var j=this.$el,k=d3.select(this.el);if(b==a){if("stem"!=a)return;k.select(".afamDonutChart").datum(e).call(d),k.select(".hispDonutChart").datum(g).call(f),k.select(".frplDonutChart").datum(i).call(h)}j.empty();switch(a){case"demand":var d=AA3.supplemental.DonutMoreInfo().title("African-American").moreInfo(function(){jumpToDetailPage("African.American")}),e=barStateMap.get("African.American").get("p_of_children_in_programs_2014")[0].answer;e=Math.round(e);var f=AA3.supplemental.DonutMoreInfo().title("Hispanic").moreInfo(function(){jumpToDetailPage("Hispanic")}),g=barStateMap.get("Hispanic").get("p_of_children_in_programs_2014")[0].answer;g=Math.round(g);var l=barStateMap.get("National").get("p_of_boys_program")[0].answer;l=Math.round(l);var m=AA3.supplemental.Pie().title(l+"% Boys").subtitle(100-l+"% Girls");AA3.supplemental.reasonList().title("Add title text").reasonNumbers([1,2,3]).metaData(metaMap.get("reason_1_not_enrolling_child")[0]);k.append("div").attr("class","supplementalData donutChart").datum(e).call(d),k.append("div").attr("class","supplementalData donutChart").datum(g).call(f),k.append("div").attr("class","supplementalData pieChart").datum(l).call(m);break;case"benefits":var n=AA3.supplemental.reasonList().reasonNumbers([1,2,3,4]).halfWidth(!0).metaData(metaMap.get("ans_1_program_provider")[0]),o=barStateMap.get("National").get("p_of_parents_program_public_school_bldg")[0].answer;o=Math.round(o);var p=AA3.supplemental.bigCenteredText().title("of Afterschool Programs are Located in a Public School Building");k.append("div").attr("class","supplementalData reasonList leftSide halfWidth").append("img").attr("src","img/Top-5-benefits-left-final.png"),k.append("div").attr("class","supplementalData reasonList halfWidth").append("img").attr("src","img/Top-5-benefits-right-final.png"),k.append("hr").attr("class","supplementalData dottedHorizontalRule"),k.append("div").attr("class","supplementalData reasonList").call(n),k.append("div").attr("class","supplementalData donutChart").datum(o).call(p);break;case"support":break;case"health":k.append("div").attr("class","supplementalData healthSpecialReport").append("img").attr("src","img/supplemental-data-health.png");break;case"summer":k.append("div").attr("class","supplementalData summerSpecialReport").append("img").attr("src","img/supplemental-summer-demographics.png");break;case"stem":k.append("div").attr("class","supplementalData donutChart afamDonutChart").datum(e).call(d),k.append("div").attr("class","supplementalData donutChart hispDonutChart").datum(g).call(f),k.append("div").attr("class","supplementalData donutChart frplDonutChart").datum(i).call(h);var q=AA3.CONFIG.PRETTY_TEXT.STEM_DEMOGRAPHIC_TITLE[c];$(".title.showByCategory.stemCategory").html(q)}this.lastCategory=a}})}),AA3=_.extend({},AA3,{socialMediaView:{render:function(){function a(a,b,c){var d=[];_.each(c,function(a,b){d.push(b+"="+a)});var e=a+d.join("&");$(b).attr("href",e)}function b(){a("https://twitter.com/intent/tweet?",".twitter-intent",{url:encodeURIComponent(window.location.href),text:encodeURIComponent("How are kids spending their time after school? New study has the answers #AmericaAfter3PM")})}function c(){a("http://www.facebook.com/sharer/sharer.php?",".facebook-intent",{u:window.location.href,"p[summary]":"How are kids spending their time after school? New study has the answers #AmericaAfter3PM"})}function d(){var a="America After 3PM: How are kids spending their time after school?",b="The new America After 3PM study from the Afterschool Alliance has found that afterschool program participation has hit a record high—more than 10 million kids head to an afterschool program after the school bell rings. But demand for these programs has also reach a new high. For every child who participates, there are two more who would like to be—if a program were available.\n\nCheck out the more of the findings, plus in-depth data on your state and special demographic reports, from the Afterschool Alliance:\n\n"+window.location.href,c="mailto:?subject="+encodeURIComponent(a)+"&body="+encodeURIComponent(b);$(".email-intent").attr("href",c)}return function(){b(),c(),d()}}()}}),AA3=_.extend({},{page:{}},AA3);_.extend(AA3.page,{detail:{init:function(){var a=new AA3.CardsView({getQuestions:getAllCurrentQuestions,getCategory:getCategory,getState:function(){return which_state},el:"#cardsWrapper"});AA3.fixDiv(),footnoteView={render:function(){$("#footnoteHolder").html(getCardText(which_state,"FOOTNOTE","text"))}},introTextView={render:function(){var a=barStateMap.get(which_state).get("intro_text")[0].answer;a||console.error("Intro text not set"),$(".masthead .mainText").html(a)}},$("#nation-nav-button").css("display","inherit"),$(".changeCategoryBtn").on("click",function(){var a=$(this),b=a.data("category");jumpToDetailPage(which_state,b,"",{trigger:!0})});var b={render:function(){var a="National",b=AA3.CONFIG.PRETTY_TEXT.STATE_NAME[which_state];a=b||stateTopoMap.get(which_state)[0].properties.name,$("#mainTitle").html(a)}},c={firstRender:!0,render:function(){var a="TRUE"==barStateMap.get(which_state).get("is_top_ten")[0].answer?!0:!1;$ribbon=$("#topTenRibbon"),a?(this.firstRender&&($ribbon.html("<img src='img/Top-10.png' alt=''>"),this.firstRender=!1),$ribbon.show()):$ribbon.hide()}};$(window).on("scroll",function(){if(!AA3.inScrollTransition){var a=!1;_.each(AA3.CONFIG.CATEGORIES,function(b){var c=AA3.scrollspy[b],d=c.offset;$(window).scrollTop()>d-500&&(a=b)}),jumpToDetailPage(which_state,a,"",{trigger:!0})}}),allViews=[b,introTextView,c,AA3.socialMediaView,a,footnoteView]}}});var AA3=_.extend({},{page:{}},AA3);_.extend(AA3.page,{national:{init:function(){function a(a){mapChart.showPopover(d3.select("#mapWrapper svg"),a)}mapChart.topoFeatures(stateTopo).topoMesh(stateMesh).clickState(function(a){a&&jumpToDetailPage(a.properties.code)}),mapView=new AA3.D3View({getData:function(){},chart:mapChart,el:"#mapWrapper > .chart"}),statesBarsView=new AA3.D3View({getData:function(){},chart:AA3.d3.barCharts().stateTopo(function(){return stateTopo}).barValue(valueOfState).gradient(getCategoryGradient).hoverState(a).clickState(function(a){a&&jumpToDetailPage(a.properties.code)}),el:"#statesBarsWrapper > .chart"}),questionsView=new AA3.QuestionsView({getCategory:getCategory,getHighlight:function(){return which_question},highlight:switchQuestionAndRender,el:"#questionsWrapper"}),supplementalDataView=new AA3.SupplementalDataView({currentCategory:function(){return which_category},currentQuestion:function(){return which_question},el:"#supplementalDataWrapper"}),allViews=[questionsView,statesBarsView,mapView,supplementalDataView,AA3.socialMediaView],$(".changeCategoryBtn").on("click",function(){var a=$(this),b=a.data("category");navigateToCategory(b,"",{trigger:!0})})}}});var AA3=_.extend({},{page:{}},AA3);_.extend(AA3.page,{print:{special:{health:{init:function(){var a=new AA3.HEPASpecialReportCardsView({getQuestions:getAllCurrentQuestions,getCategory:getCategory,getState:getState,keys:["children_in_afterschool","healthy_eating"],el:".cardsWrapper.firstHalfCards"}),b=new AA3.HEPASpecialReportCardsView({getQuestions:getAllCurrentQuestions,getCategory:getCategory,getState:getState,keys:["physical_activity","public_support"],el:".cardsWrapper.secondHalfCards"});footnoteView={render:function(){var a=_.template($("#print-footnoteTemplate").text());$(".secondPageFooter").html(a({state_footnote:getCardText(which_state,"FOOTNOTE","text")}))}},introTextView={render:function(){var a=_.template($("#print-introTemplate").text()),b=barStateMap.get(which_state||"National"),c=b.get("real_of_children_in_programs_2014"),d=b.get("real_of_children_would_be_enrolled_2014"),e={state_name:prettyStateName(which_state),projection_do_participate:c&&c[0].answer||"UNAVAILABLE",projection_would_participate:d&&d[0].answer||"UNAVAILABLE"},f=a(e);$(".masthead .mainIntroText").html(f)}};var c={render:function(){$(".mainTitle .stateName").html(prettyStateName(which_state))}};allViews=[c,introTextView,a,b,footnoteView]}}}}});var AA3=_.extend({},{page:{}},AA3);_.extend(AA3.page,{printnamechangefixcollision:{special:{STEM:{init:function(){var a=new AA3.STEMCardsView({getQuestions:getAllCurrentQuestions,getCategory:getCategory,getState:getState,keys:["stem_a","stem_b"],el:".cardsWrapper.firstHalfCards"}),b=new AA3.STEMCardsView({getQuestions:getAllCurrentQuestions,getCategory:getCategory,getState:getState,keys:["children_in_afterschool"],el:".cardsWrapper.secondHalfCards"});footnoteView={render:function(){var a=_.template($("#print-footnoteTemplate").text());$(".secondPageFooter").html(a({state_footnote:getCardText(which_state,"FOOTNOTE","text")}))}},introTextView={render:function(){var a=_.template($("#print-introTemplate").text()),b=barStateMap.get(which_state||"National"),c=b.get("real_of_children_in_programs_2014"),d=b.get("real_of_children_would_be_enrolled_2014"),e={state_name:prettyStateName(which_state),projection_do_participate:c&&c[0].answer||"UNAVAILABLE",projection_would_participate:d&&d[0].answer||"UNAVAILABLE"},f=a(e);$(".masthead .mainIntroText").html(f)}};var c={render:function(){$(".mainTitle .stateName").html(prettyStateName(which_state))}};allViews=[c,introTextView,a,b,footnoteView]}}}}});var which_category="demand",which_question="p_of_children_in_programs_2014",which_state=null,Workspace=Backbone.Router.extend({routes:{"c/:category":"category","c/:category/:question":"category","q/:question":"question","s/:state":"detail","s/:state/:category":"detail","s/:state/:category/:question":"detail","print/health/:state":"printHepa","print/stem/:state":"printStem","*path":"defaultRoute"}}),workspace=new Workspace;workspace.on("route:printHepa",function(a){which_state=a,category="health",question=highestPriorityQuestion(category),renderAllViews()}),workspace.on("route:printStem",function(a){which_state=a,category="stem",question=highestPriorityQuestion(category),renderAllViews()}),workspace.on("route:category",function(a,b){b&&metaMap.get(b)||(b=highestPriorityQuestion(a),navigateToCategory(a,b,{replace:!0})),which_category=a,which_question=b,renderAllViews()}),workspace.on("route:question",switchQuestionAndRender),workspace.on("route:defaultRoute",renderAllViews),workspace.on("route:detail",function(a,b){b||(b="demand"),a||jumpToNationalPage("demand"),which_state=a,which_category=b,renderAllViews()});var STATES_AND_DC=["AL","AK","AZ","AR","CA","CO","CT","DC","DE","FL","GA","HI","ID","IL","IN","IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY"],barStateMap,metaMap,cardMap,HEPASpecialReportMap,STEMNewsReleaseMap,cardText,stateTopo,stateTopoMap,stateMesh,questionsView,supplementalDataView,statesBarsView,mapView,questionHighlightView,allViews=[];AA3.inScrollTransition=!1;var baseColorScale=d3.scale.quantize().domain([0,100]),demandColors=["#CE4984","#D35C91","#D86F9E","#DE83AB","#E396B8","#E8A9C5","#EDBCD2","#F3D0DF","#F8E3EC"],benefitsColors=["#32AEC4","#48B7CA","#5DBFD0","#73C8D7","#89D0DD","#9ED9E3","#B4E1E9","#CAEAF0","#DFF2F6"],supportColors=["#0A6AC2","#247AC8","#3E8ACF","#5899D5","#72A9DC","#8BB9E2","#A5C9E9","#BFD8EF","#D9E8F6"],healthColors=["#E78924","#EA953B","#ECA151","#EFAE68","#F2BA7F","#F4C695","#F7D2AC","#FADFC3","#FCEBD9"],summerColors=["#E6D23E","#E8D64F","#EADA60","#EDDE71","#EFE282","#F1E692","#F3EAA3","#F6EEB4","#F8F2C5"],stemColors=["#563B7F","#654D8B","#745E96","#8470A2","#9382AD","#A293B9","#B1A5C4","#C1B7D0","#D0C8DB"],categoryColorScales={demand:baseColorScale.copy().range(demandColors.reverse()),benefits:baseColorScale.copy().range(benefitsColors.reverse()),support:baseColorScale.copy().range(supportColors.reverse()),health:baseColorScale.copy().range(healthColors.reverse()),summer:baseColorScale.copy().range(summerColors.reverse()),stem:baseColorScale.copy().range(stemColors.reverse())},stateNester=d3.nest().key(function(a){return a.state}).key(function(a){return a.slug}),metaNester=d3.nest().key(function(a){return a.slug}),cardNester=d3.nest().key(function(a){return a.category}).key(function(a){return a["card.container"]}).key(function(a){return a.slug}),HEPASpecialReportNester=d3.nest().key(function(a){return a.category}).key(function(a){return a["HEPASpecialReport.container"]}).key(function(a){return a.slug}),STEMNewsReleaseNester=d3.nest().key(function(a){return a.category}).key(function(a){return a["STEMNewsRelease.container"]}).key(function(a){return a.slug}),cardTextNester=d3.nest().key(function(a){return a.state}).key(function(a){return a.slug}),stateTopoNester=d3.nest().key(function(a){return a.properties.code}),mapChart=AA3.d3.usMap().valueOfState(valueOfState).gradient(getCategoryGradient).hoverState(function(){});promiseLoadAllDataAndOnReady().then(function(a){initCombobox()}).then(initializePage).then(function(){Backbone.history.start({pushState:!1})}).done();